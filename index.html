<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EMR Klinik dr. H. DUDI RUHENDERA</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --primary:#0b5ed7;
  --danger:#dc3545;
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#212529;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:var(--bg);color:var(--text)}
.hidden{display:none}
header{background:var(--primary);color:#fff;padding:18px;text-align:center}
.container{max-width:1400px;margin:auto;padding:20px}
.card{background:var(--card);padding:20px;border-radius:14px;margin-bottom:16px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
input,select,textarea,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:1px solid #ced4da;font-size:14px}
button{background:var(--primary);color:#fff;border:none;font-weight:600;cursor:pointer}
button.secondary{background:#6c757d}
button.danger{background:var(--danger)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.menu-card{text-align:center;padding:30px 20px;cursor:pointer;font-weight:600}
.menu-card:hover{background:#f1f5ff}
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
th,td{border:1px solid #dee2e6;padding:8px}
th{background:#f8f9fa}
.total{font-size:18px;font-weight:bold;text-align:right;margin-top:10px}
.badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:12px;background:#e9ecef}
.footer-note{font-size:11px;color:#666;text-align:center;margin-top:20px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="container">
    <div class="card" style="max-width:420px;margin:auto">
      <h2 style="text-align:center">LOGIN EMR</h2>
      <input id="username" placeholder="Username">
      <input id="pin" type="password" placeholder="PIN">
      <button onclick="login()">MASUK</button>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage" class="hidden">
  <header>
    <b>Sistem Informasi EMR</b><br>
    Klinik dr. H. DUDI RUHENDERA
  </header>

  <div class="container">

    <div class="card">
      Login: <b id="userName"></b><br>
      Role: <span class="badge" id="userRole"></span>
    </div>

    <div id="menu" class="grid"></div>

    <!-- RIWAYAT -->
    <div id="riwayatPage" class="card hidden">
      <h3>Riwayat Pasien</h3>
      <div class="grid">
        <input id="rmCari" placeholder="Nomor Rekam Medis">
        <button onclick="loadRiwayat()">Cari</button>
        <button class="secondary" onclick="cetakPDFRiwayat()">Cetak PDF</button>
      </div>
      <div id="hasilRiwayat" style="margin-top:15px"></div>
    </div>

    <!-- OBAT -->
    <div id="obatPage" class="card hidden">
      <h3>Obat & Pembayaran</h3>
      <div class="grid">
        <input id="rmBayar" placeholder="Nomor RM">
        <button onclick="loadPasienBayar()">Cari Pasien</button>
      </div>
      <p><b id="infoBayar"></b></p>
      <div class="grid">
        <input id="namaObat" placeholder="Nama Obat">
        <input id="hargaObat" type="number" placeholder="Harga">
        <button onclick="tambahObat()">Tambah</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Obat</th><th>Harga</th></tr></thead>
          <tbody id="listObat"></tbody>
        </table>
      </div>
      <div class="total">Total: Rp <span id="totalBayar">0</span></div>
      <select id="statusBayar">
        <option value="LUNAS">LUNAS</option>
        <option value="BELUM LUNAS">BELUM LUNAS</option>
      </select>
      <button onclick="simpanPembayaran()">Simpan Pembayaran</button>
    </div>

    <!-- BPJS -->
    <div id="bpjsPage" class="card hidden">
      <h3>Registrasi BPJS</h3>
      <div class="grid">
        <input id="bpjs_rm" placeholder="Nomor RM">
        <input id="bpjs_noka" placeholder="No Kartu BPJS">
        <input id="bpjs_nik" placeholder="NIK">
        <select id="bpjs_poli">
          <option value="UMUM">Poli Umum</option>
          <option value="GIGI">Poli Gigi</option>
          <option value="KIA">Poli KIA</option>
        </select>
      </div>
      <button onclick="simpanBPJS()">Simpan BPJS</button>
      <div id="bpjsInfo" style="margin-top:10px"></div>
    </div>

    <div class="card">
      <button class="danger" onclick="logout()">Logout</button>
    </div>

    <div class="footer-note">
      ¬© EMR Klinik dr. H. DUDI RUHENDERA ‚Äì Data bersifat rahasia
    </div>

  </div>
</div>

<script>
/* USERS */
const USERS={
  "H.dudi_ruhendra":{pin:"Qwerty1234",role:"Dokter / Admin"},
  "Username1":{pin:"User1",role:"Pendaftaran & Anamnesa"},
  "User2":{pin:"Username2",role:"Obat & Pembayaran"}
};

/* FIREBASE */
firebase.initializeApp({
  databaseURL:"https://develop-program-erm-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db=firebase.database();

/* LOGIN */
function login(){
  const u=username.value.trim();
  const p=pin.value.trim();
  if(!u||!p) return alert("Lengkapi data");
  if(USERS[u] && USERS[u].pin===p){
    localStorage.setItem("emr_user",u);
    showDashboard();
  }else alert("Login salah");
}

/* DASHBOARD */
function showDashboard(){
  const u=localStorage.getItem("emr_user");
  if(!u) return;
  loginPage.classList.add("hidden");
  dashboardPage.classList.remove("hidden");
  userName.innerText=u;
  userRole.innerText=USERS[u].role;

  menu.innerHTML=`
    <div class="card menu-card" onclick="openRiwayat()">üìÅ Riwayat Pasien</div>
    <div class="card menu-card" onclick="openObat()">üíä Obat & Pembayaran</div>
    <div class="card menu-card" onclick="openBPJS()">ü©∫ BPJS</div>
  `;
}

/* UTIL */
function hideAll(){
  riwayatPage.classList.add("hidden");
  obatPage.classList.add("hidden");
  bpjsPage.classList.add("hidden");
}

function openRiwayat(){hideAll();riwayatPage.classList.remove("hidden")}
function openObat(){hideAll();obatPage.classList.remove("hidden")}
function openBPJS(){hideAll();bpjsPage.classList.remove("hidden")}

function logout(){localStorage.clear();location.reload()}
if(localStorage.getItem("emr_user")) showDashboard();
</script>

</body>
</html>
