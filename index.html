<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMR Klinik dr. H. DUDI RUHENDERA</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{--p:#0b5ed7;--bg:#f4f6f8}
body{margin:0;font-family:Arial;background:var(--bg)}
.hidden{display:none}
header{background:var(--p);color:#fff;padding:15px;text-align:center}
.container{padding:20px;max-width:1100px;margin:auto}
.card{background:#fff;padding:20px;border-radius:12px;margin-bottom:15px;box-shadow:0 6px 16px rgba(0,0,0,.08)}
input,textarea,button{width:100%;padding:12px;margin-top:8px;border-radius:8px;border:1px solid #ccc}
button{background:var(--p);color:#fff;border:none;font-weight:bold;cursor:pointer}
.list{padding:10px;border-bottom:1px solid #eee}
.big{font-size:48px;text-align:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
<div class="container">
<div class="card">
<h2 align="center">LOGIN EMR</h2>
<input id="username" placeholder="Username">
<input id="pin" type="password">
<button onclick="login()">MASUK</button>
</div>
</div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage" class="hidden">
<header>EMR KLINIK dr. H. DUDI RUHENDERA</header>
<div class="container">

<div class="card">
Login: <b id="userName"></b> | Role: <b id="userRole"></b>
</div>

<div class="card">
<button onclick="openDaftar()">Pendaftaran</button>
<button onclick="openDokter()">Dokter</button>
<button onclick="openTV()">ðŸ“º TV Antrian</button>
</div>

<!-- PENDAFTARAN -->
<div id="daftarPage" class="card hidden">
<h3>Pendaftaran Pasien</h3>
<input id="nama" placeholder="Nama Pasien">
<button onclick="simpanPasien()">SIMPAN</button>
</div>

<!-- DOKTER -->
<div id="dokterPage" class="card hidden">
<h3>Antrian Dokter</h3>
<div id="listAntrian"></div>

<hr>
<h3>SOAP</h3>
<b id="soapRM"></b>
<textarea id="soapText" placeholder="SOAP Dokter"></textarea>
<button onclick="simpanSOAP()">SIMPAN SOAP</button>
</div>

</div>
</div>

<!-- TV ANTRIAN -->
<div id="tvPage" class="hidden">
<header style="font-size:30px">ðŸ“º ANTRIAN POLI</header>
<div class="container">
<div class="card">
<div id="tvNama" class="big">MENUNGGU...</div>
</div>
</div>
</div>

<script>
/* USER */
const USERS={
  dokter:{pin:"123",role:"Dokter"},
  daftar:{pin:"123",role:"Pendaftaran"}
};

/* FIREBASE */
firebase.initializeApp({
  databaseURL:"https://develop-program-erm-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db=firebase.database();

/* LOGIN */
function login(){
  if(USERS[username.value] && USERS[username.value].pin===pin.value){
    localStorage.setItem("u",username.value);
    showDashboard();
  } else alert("Login salah");
}

function showDashboard(){
  loginPage.classList.add("hidden");
  dashboardPage.classList.remove("hidden");
  userName.innerText=localStorage.getItem("u");
  userRole.innerText=USERS[localStorage.getItem("u")].role;
}

/* NAV */
function hideAll(){
  daftarPage.classList.add("hidden");
  dokterPage.classList.add("hidden");
}
function openDaftar(){ hideAll(); daftarPage.classList.remove("hidden"); }
function openDokter(){ hideAll(); dokterPage.classList.remove("hidden"); loadAntrian(); }
function openTV(){ window.open("index.html?tv=1","_blank"); }

/* DAFTAR */
function simpanPasien(){
  const rm="RM"+Date.now();
  db.ref("pasien/"+rm).set({
    nama:nama.value,
    status:"ANTRI",
    created:new Date().toISOString()
  });
  alert("Pasien masuk antrian");
}

/* DOKTER */
let aktifRM="";
function loadAntrian(){
  db.ref("pasien").orderByChild("status").equalTo("ANTRI")
  .on("value",s=>{
    listAntrian.innerHTML="";
    s.forEach(x=>{
      listAntrian.innerHTML+=`
      <div class="list">
        ${x.val().nama}
        <button onclick="panggil('${x.key}','${x.val().nama}')">PANGGIL</button>
      </div>`;
    });
  });
}

function panggil(rm,nama){
  aktifRM=rm;
  soapRM.innerText="RM: "+rm+" | "+nama;
  db.ref("pasien/"+rm+"/status").set("DIPANGGIL");
}

function simpanSOAP(){
  db.ref("soap/"+aktifRM).set({
    soap:soapText.value,
    dokter:localStorage.getItem("u"),
    waktu:new Date().toISOString()
  });
  db.ref("pasien/"+aktifRM+"/status").set("SELESAI");
  alert("SOAP tersimpan");
}

/* TV MODE */
function showTV(){
  loginPage.classList.add("hidden");
  dashboardPage.classList.add("hidden");
  tvPage.classList.remove("hidden");

  db.ref("pasien").orderByChild("status").equalTo("DIPANGGIL")
  .on("value",s=>{
    let nama="MENUNGGU...";
    s.forEach(x=>nama=x.val().nama);
    tvNama.innerText=nama;
  });
}

if(new URLSearchParams(location.search).get("tv")==="1") showTV();
if(localStorage.getItem("u")) showDashboard();
</script>

</body>
</html>
