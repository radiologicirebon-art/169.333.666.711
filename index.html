<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EMR Klinik Modern</title>

<!-- =====================================================
  EMR KLINIK MODERN
  Filosofi:
  - CLEAN UI (putih, ringan, fokus kerja)
  - CEPAT (minim klik, minim distraksi)
  - ENAK DIPAKAI (alur klinis nyata)
  - BUKAN DEMO, BUKAN TEMPLATE
====================================================== -->

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
/* ================= RESET ================= */
* { box-sizing: border-box; font-family: 'Inter', Arial, sans-serif; }
body { margin:0; background:#f9fafb; color:#111827; }
.hidden { display:none; }

/* ================= LAYOUT ================= */
header {
  height:56px;
  background:#ffffff;
  border-bottom:1px solid #e5e7eb;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
  font-weight:600;
}

.app {
  display:flex;
  min-height:calc(100vh - 56px);
}

nav {
  width:220px;
  background:#ffffff;
  border-right:1px solid #e5e7eb;
  padding:12px;
}

nav button {
  width:100%;
  text-align:left;
  padding:10px 12px;
  margin-bottom:6px;
  border-radius:8px;
  border:none;
  background:transparent;
  cursor:pointer;
}
nav button:hover { background:#f3f4f6; }

main {
  flex:1;
  padding:24px;
}

.card {
  background:#ffffff;
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.04);
}

h2 { margin:0 0 12px; font-size:18px; }
label { font-size:13px; color:#6b7280; }
input, textarea, select {
  width:100%;
  padding:10px 12px;
  margin-top:4px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #d1d5db;
}
button.primary {
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
}
button.danger {
  background:#ef4444;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
}

.list {
  display:flex;
  flex-direction:column;
  gap:8px;
}
.item {
  padding:12px;
  border:1px solid #e5e7eb;
  border-radius:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.badge {
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}
.badge.hijau { background:#dcfce7; color:#166534; }
.badge.kuning { background:#fef9c3; color:#854d0e; }
.badge.merah { background:#fee2e2; color:#991b1b; }
</style>
<!-- ================= PWA META ================= -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<style>
/* ================= MICRO INTERACTIONS ================= */
.card{transition:transform .15s ease, box-shadow .15s ease}
.card:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(0,0,0,.08)}
button.primary{transition:background .15s ease, transform .1s ease}
button.primary:active{transform:scale(.97)}
</style>
</head>
<body>

<!-- ================= LOGIN ================= -->
<div id="login" class="card" style="max-width:380px;margin:120px auto">
  <h2>Login EMR Klinik</h2>
  <input id="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button class="primary" onclick="login()">Masuk</button>
</div>

<!-- ================= APP ================= -->
<div id="app" class="hidden">
<header>
  <span id="appTitle">EMR Klinik</span>
  <button class="danger" onclick="logout()">Logout</button>
</header>

<div class="app">

<nav id="menu"></nav>

<main>

<!-- DASHBOARD -->
<div id="dashboard" class="card">
  <h2>Dashboard</h2>
  <p style="color:#6b7280">Ringkasan aktivitas hari ini</p>
</div>

<!-- TRIAGE -->
<div id="triase" class="card hidden">
  <h2>Triase Pasien</h2>
  <label>Nama Pasien</label>
  <input id="tNama" />
  <label>Kategori</label>
  <select id="tKategori">
    <option value="hijau">Hijau</option>
    <option value="kuning">Kuning</option>
    <option value="merah">Merah</option>
  </select>
  <label>Keluhan Utama</label>
  <textarea id="tKeluhan"></textarea>
  <button class="primary" onclick="simpanTriase()">Simpan</button>
</div>

<!-- ANTRIAN DOKTER -->
<div id="antrian" class="card hidden">
  <h2>Antrian Dokter</h2>
  <div id="listAntrian" class="list"></div>
</div>

<!-- SOAP -->
<div id="soap" class="card hidden">
  <h2>SOAP</h2>
  <textarea id="sS" placeholder="Subjective"></textarea>
  <textarea id="sO" placeholder="Objective"></textarea>
  <textarea id="sA" placeholder="Assessment"></textarea>
  <textarea id="sP" placeholder="Plan"></textarea>
  <button class="primary" onclick="simpanSOAP()">Selesaikan</button>
</div>

<!-- FARMASI -->
<div id="farmasi" class="card hidden">
  <h2>Farmasi</h2>
  <div id="listResep" class="list"></div>
</div>

</main>
</div>
</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey:"ISI_API_KEY",
  authDomain:"ISI_AUTH_DOMAIN",
  databaseURL:"ISI_DB_URL",
  projectId:"ISI_PROJECT_ID"
});

const auth = firebase.auth();
const db = firebase.database();
let currentRole = null;
let currentAntrian = null;

/* ================= AUTH ================= */
function login(){
  auth.signInWithEmailAndPassword(email.value, password.value)
  .catch(e => alert(e.message));
}

function logout(){ auth.signOut(); location.reload(); }

/* ================= ROUTING ================= */
auth.onAuthStateChanged(user => {
  if(!user) return;
  login.classList.add('hidden');
  app.classList.remove('hidden');

  db.ref('users/'+user.uid+'/role').once('value').then(snap => {
    currentRole = snap.val();
    buildMenu();
  });
});

function buildMenu(){
  menu.innerHTML = '';
  addMenu('Dashboard','dashboard');

  if(currentRole==='perawat') addMenu('Triase','triase');
  if(currentRole==='dokter') addMenu('Antrian','antrian');
  if(currentRole==='farmasi') addMenu('Farmasi','farmasi');
}

function addMenu(label, target){
  const btn = document.createElement('button');
  btn.innerText = label;
  btn.onclick = () => show(target);
  menu.appendChild(btn);
}

function show(id){
  document.querySelectorAll('main .card').forEach(c=>c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* ================= PERAWAT ================= */
function simpanTriase(){
  const data = {
    nama: tNama.value,
    kategori: tKategori.value,
    keluhan: tKeluhan.value,
    waktu: new Date().toLocaleString()
  };
  db.ref('antrian').push(data);
  tNama.value=''; tKeluhan.value='';
  alert('Triase tersimpan');
}

/* ================= DOKTER ================= */
db.ref('antrian').on('value', snap => {
  listAntrian.innerHTML='';
  snap.forEach(c=>{
    const d = c.val();
    const div = document.createElement('div');
    div.className='item';
    div.innerHTML = `<div><b>${d.nama}</b><br><span class="badge ${d.kategori}">${d.kategori}</span></div>`;
    if(currentRole==='dokter'){
      const btn = document.createElement('button');
      btn.className='primary';
      btn.innerText='Periksa';
      btn.onclick=()=>{ currentAntrian=c.key; show('soap'); };
      div.appendChild(btn);
    }
    listAntrian.appendChild(div);
  });
});

function simpanSOAP(){
  db.ref('rekam_medis/'+currentAntrian).push({
    S:sS.value,O:sO.value,A:sA.value,P:sP.value,
    waktu:new Date().toLocaleString()
  });
  db.ref('antrian/'+currentAntrian).remove();
  show('antrian');
}

/* ================= FARMASI ================= */
db.ref('resep').on('value', snap => {
  listResep.innerHTML='';
  snap.forEach(c=>{
    const li = document.createElement('div');
    li.className='item';
    li.innerText=c.val().obat;
    listResep.appendChild(li);
  });
});
</script>
</body>
</html>
