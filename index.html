<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMR Klinik H. Dudi â€“ DEMO RS</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;font-family:Inter,Arial}
body{margin:0;background:#f9fafb}
.hidden{display:none}
header{
  height:56px;background:#fff;border-bottom:1px solid #e5e7eb;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;font-weight:600
}
.app{display:flex;min-height:calc(100vh - 56px)}
nav{width:220px;background:#fff;border-right:1px solid #e5e7eb;padding:12px}
nav button{
  width:100%;padding:10px;margin-bottom:6px;
  border:none;border-radius:8px;background:transparent;
  text-align:left;cursor:pointer
}
nav button:hover{background:#f3f4f6}
main{flex:1;padding:24px}
.card{
  background:#fff;border-radius:14px;padding:20px;margin-bottom:20px;
  box-shadow:0 8px 20px rgba(0,0,0,.04)
}
input,textarea,select{
  width:100%;padding:10px;margin-bottom:10px;
  border-radius:10px;border:1px solid #d1d5db
}
button.primary{
  background:#2563eb;color:#fff;border:none;
  padding:10px 16px;border-radius:10px;cursor:pointer
}
table{width:100%;border-collapse:collapse}
td{padding:10px;border-bottom:1px solid #e5e7eb}
tr:hover{background:#f9fafb;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
</style>
</head>

<body>

<header>
  <span>EMR Klinik H. Dudi <small>(DEMO RS)</small></span>
  <select onchange="setRole(this.value)">
    <option value="">Pilih Role</option>
    <option value="dashboard">Dashboard</option>
    <option value="pendaftaran">Pendaftaran</option>
    <option value="perawat">Perawat</option>
    <option value="dokter">Dokter</option>
    <option value="farmasi">Farmasi</option>
    <option value="tv">TV Antrian</option>
  </select>
</header>

<div class="app">
<nav id="menu"></nav>
<main>

<!-- DASHBOARD -->
<div id="dashboard" class="card">
<h2>Dashboard</h2>
<canvas id="grafikKunjungan" height="120"></canvas>
</div>

<!-- PENDAFTARAN -->
<div id="pendaftaran" class="card hidden">
<h2>Pendaftaran Rekam Medis</h2>
<input id="namaPasien" placeholder="Nama Pasien">
<button class="primary" onclick="daftarPasien()">Daftarkan</button>
</div>

<!-- PERAWAT -->
<div id="perawat" class="card hidden">
<h2>Daftar Pasien Perawat</h2>
<table><tbody id="tabelPerawat"></tbody></table>
</div>

<!-- ðŸ”¥ ANAMNESA RS -->
<div id="anamnesa" class="card hidden">
<h2>Anamnesa Keperawatan (RS)</h2>
<p><b id="infoPerawat"></b></p>

<textarea id="keluhan" placeholder="Keluhan Utama"></textarea>
<textarea id="rps" placeholder="Riwayat Penyakit Sekarang"></textarea>
<textarea id="rpd" placeholder="Riwayat Penyakit Dahulu"></textarea>
<input id="alergi" placeholder="Riwayat Alergi">

<select id="kesadaran">
  <option value="">Kesadaran</option>
  <option>Compos Mentis</option>
  <option>Apatis</option>
  <option>Somnolen</option>
  <option>Sopor</option>
  <option>Koma</option>
</select>

<div class="grid">
<input id="td" placeholder="TD (mmHg)">
<input id="nadi" placeholder="Nadi (x/menit)">
<input id="rr" placeholder="RR (x/menit)">
<input id="suhu" placeholder="Suhu (Â°C)">
<input id="spo2" placeholder="SpOâ‚‚ (%)">
<input id="bbtb" placeholder="BB / TB">
</div>

<textarea id="catatanPerawat" placeholder="Catatan Perawat"></textarea>

<button class="primary" onclick="simpanAnamnesa()">Simpan Anamnesa</button>
</div>

<!-- DOKTER -->
<div id="dokter" class="card hidden">
<h2>Dokter</h2>
<table><tbody id="tabelDokter"></tbody></table>
</div>

<div id="soap" class="card hidden">
<h2>SOAP Dokter</h2>
<p id="infoDokter"></p>
<textarea id="diagnosis" placeholder="Diagnosis"></textarea>
<textarea id="resep" placeholder="Resep"></textarea>
<button class="primary" onclick="simpanSOAP()">Simpan</button>
</div>

<!-- FARMASI -->
<div id="farmasi" class="card hidden">
<h2>Farmasi</h2>
<table><tbody id="tabelFarmasi"></tbody></table>
</div>

<!-- TV -->
<div id="tv" class="card hidden" style="text-align:center">
<h1 style="font-size:48px">ANTRIAN</h1>
<div id="tvNomor" style="font-size:120px;font-weight:800">-</div>
<div id="tvNama" style="font-size:36px"></div>
</div>

</main>
</div>

<script>
firebase.initializeApp({
databaseURL:"https://develop-program-erm-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();
let pasienAktif=null;

function setRole(r){
menu.innerHTML='';
['dashboard',r].forEach(i=>{
if(!i)return;
let b=document.createElement('button');
b.innerText=i.toUpperCase();
b.onclick=()=>show(i);
menu.appendChild(b);
});
show(r||'dashboard');
}
function show(i){
document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
document.getElementById(i).classList.remove('hidden');
}

function daftarPasien(){
db.ref('kunjungan').push({
nama:namaPasien.value,
antrian:'A'+Math.floor(Math.random()*900),
status:'menunggu_perawat'
});
alert('Pasien terdaftar');
}

db.ref('kunjungan').on('value',s=>{
tabelPerawat.innerHTML=tabelDokter.innerHTML='';
s.forEach(c=>{
let d=c.val();
if(d.status==='menunggu_perawat'){
let r=document.createElement('tr');
r.innerHTML=`<td>${d.antrian}</td><td>${d.nama}</td>`;
r.onclick=()=>{
pasienAktif=c.key;
infoPerawat.innerText=d.nama;
show('anamnesa');
};
tabelPerawat.appendChild(r);
}
if(d.status==='menunggu_dokter'){
let r=document.createElement('tr');
r.innerHTML=`<td>${d.antrian}</td><td>${d.nama}</td>`;
r.onclick=()=>{
pasienAktif=c.key;
infoDokter.innerText=d.nama;
show('soap');
};
tabelDokter.appendChild(r);
}
});
});

function simpanAnamnesa(){
db.ref('kunjungan/'+pasienAktif).update({
anamnesa:{
keluhan:keluhan.value,
rps:rps.value,
rpd:rpd.value,
alergi:alergi.value,
kesadaran:kesadaran.value,
ttv:{td:td.value,nadi:nadi.value,rr:rr.value,suhu:suhu.value,spo2:spo2.value},
bbtb:bbtb.value,
catatan:catatanPerawat.value
},
status:'menunggu_dokter'
});
show('perawat');
}

function simpanSOAP(){
db.ref('kunjungan/'+pasienAktif).update({
diagnosis:diagnosis.value,
resep:resep.value,
status:'farmasi'
});
show('dokter');
}
</script>

</body>
</html>
