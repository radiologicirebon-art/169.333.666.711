<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMR Klinik H. Dudi â€“ DEMO</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;font-family:Inter,Arial}
body{margin:0;background:#f9fafb}
.hidden{display:none}

header{
  height:56px;background:#fff;border-bottom:1px solid #e5e7eb;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;font-weight:600
}
.app{display:flex;min-height:calc(100vh - 56px)}

nav{
  width:220px;background:#fff;border-right:1px solid #e5e7eb;padding:12px
}
nav button{
  width:100%;padding:10px;margin-bottom:6px;
  border:none;border-radius:8px;background:transparent;
  text-align:left;cursor:pointer
}
nav button:hover{background:#f3f4f6}

main{flex:1;padding:24px}

.card{
  background:#fff;border-radius:14px;padding:20px;margin-bottom:20px;
  box-shadow:0 8px 20px rgba(0,0,0,.04)
}

.stat{display:flex;gap:16px;margin-bottom:20px}
.stat div{
  flex:1;background:#f1f5f9;border-radius:12px;
  padding:14px;text-align:center
}
.stat b{font-size:26px;display:block}

input,textarea,select{
  width:100%;padding:10px;margin-bottom:12px;
  border-radius:10px;border:1px solid #d1d5db
}

button.primary{
  background:#2563eb;color:#fff;border:none;
  padding:10px 16px;border-radius:10px;cursor:pointer
}
button.success{
  background:#16a34a;color:#fff;border:none;
  padding:8px 14px;border-radius:10px;cursor:pointer
}

table{width:100%;border-collapse:collapse}
td{padding:10px;border-bottom:1px solid #e5e7eb}
tr:hover{background:#f9fafb;cursor:pointer}
</style>
</head>

<body>

<header>
  <span>EMR Klinik H. Dudi <small>(DEMO)</small></span>
  <select onchange="setRole(this.value)">
    <option value="">Pilih Role</option>
    <option value="dashboard">Dashboard</option>
    <option value="pendaftaran">Pendaftaran</option>
    <option value="perawat">Perawat</option>
    <option value="dokter">Dokter</option>
    <option value="farmasi">Farmasi</option>
    <option value="tv">TV Antrian</option>
  </select>
</header>

<div class="app">
<nav id="menu"></nav>

<main>

<!-- DASHBOARD -->
<div id="dashboard" class="card">
  <h2>Dashboard Kunjungan</h2>
  <div class="stat">
    <div><b id="total">0</b>Total</div>
    <div><b id="menunggu">0</b>Menunggu</div>
    <div><b id="selesai">0</b>Selesai</div>
  </div>
  <canvas id="chart" height="120"></canvas>
</div>

<!-- PENDAFTARAN -->
<div id="pendaftaran" class="card hidden">
  <h2>Pendaftaran Pasien</h2>
  <input id="nama" placeholder="Nama Pasien">
  <input id="nik" placeholder="NIK">
  <select id="jk"><option>Laki-laki</option><option>Perempuan</option></select>
  <input id="tgl" type="date">
  <input id="alamat" placeholder="Alamat">
  <select id="poli"><option>Umum</option><option>Gigi</option></select>
  <button class="primary" onclick="daftar()">Daftarkan</button>
</div>

<!-- PERAWAT -->
<div id="perawat" class="card hidden">
  <h2>Perawat</h2>
  <table><tbody id="tblPerawat"></tbody></table>
</div>

<div id="anamnesa" class="card hidden">
  <h2>Anamnesa & Triase</h2>
  <b id="infoPerawat"></b>
  <textarea id="keluhan" placeholder="Keluhan utama"></textarea>
  <input id="td" placeholder="TD">
  <input id="suhu" placeholder="Suhu">
  <select id="triase">
    <option>Hijau</option><option>Kuning</option><option>Merah</option>
  </select>
  <button class="primary" onclick="kirimDokter()">Kirim ke Dokter</button>
</div>

<!-- DOKTER -->
<div id="dokter" class="card hidden">
  <h2>Dokter</h2>
  <table><tbody id="tblDokter"></tbody></table>
</div>

<div id="soap" class="card hidden">
  <h2>SOAP Dokter</h2>
  <textarea id="diagnosa" placeholder="Diagnosis"></textarea>
  <textarea id="resep" placeholder="Resep"></textarea>
  <button class="primary" onclick="selesaiDokter()">Simpan</button>
</div>

<!-- FARMASI -->
<div id="farmasi" class="card hidden">
  <h2>Farmasi</h2>
  <table><tbody id="tblFarmasi"></tbody></table>
</div>

<!-- TV -->
<div id="tv" class="card hidden" style="text-align:center">
  <h1>ANTRIAN</h1>
  <div id="tvNomor" style="font-size:120px">-</div>
  <div id="tvNama">Menunggu</div>
</div>

</main>
</div>

<script>
firebase.initializeApp({
  databaseURL:"https://develop-program-erm-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();
let aktif=null, chart=null;

function setRole(r){
  menu.innerHTML='';
  addMenu('Dashboard','dashboard');
  if(r)addMenu(r.toUpperCase(),r);
  show('dashboard');
}
function addMenu(t,i){
  let b=document.createElement('button');
  b.innerText=t;b.onclick=()=>show(i);menu.appendChild(b);
}
function show(id){
  document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function daftar(){
  const antrian='A'+Math.floor(Math.random()*900);
  db.ref('kunjungan').push({
    nama:nama.value,nik:nik.value,jk:jk.value,
    tgl:tgl.value,alamat:alamat.value,poli:poli.value,
    antrian,status:'perawat'
  });
  show('dashboard');
}

db.ref('kunjungan').on('value',s=>{
  let mp=0,md=0,sls=0;
  tblPerawat.innerHTML=tblDokter.innerHTML=tblFarmasi.innerHTML='';
  s.forEach(c=>{
    let d=c.val();
    if(d.status==='perawat'){mp++;row(tblPerawat,d,c,'anamnesa')}
    if(d.status==='dokter'){md++;row(tblDokter,d,c,'soap')}
    if(d.status==='selesai'){sls++;row(tblFarmasi,d,c)}
  });
  total.innerText=s.size;
  menunggu.innerText=mp+md;
  selesai.innerText=sls;
});

function row(tbl,d,c,next){
  let r=document.createElement('tr');
  r.innerHTML=`<td>${d.antrian}</td><td>${d.nama}</td>`;
  r.onclick=()=>{aktif=c.key;infoPerawat.innerText=d.nama;show(next)};
  tbl.appendChild(r);
}
function kirimDokter(){
  db.ref(`kunjungan/${aktif}/status`).set('dokter');
  show('perawat');
}
function selesaiDokter(){
  db.ref(`kunjungan/${aktif}`).update({status:'selesai',diagnosa:diagnosa.value,resep:resep.value});
  show('dokter');
}
</script>

</body>
</html>
