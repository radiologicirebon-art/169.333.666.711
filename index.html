<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Informasi EMR - Klinik dr. H. DUDI RUHENDERA</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{--p:#0b5ed7;--d:#dc3545;--bg:#f4f6f8}
body{margin:0;font-family:Arial;background:var(--bg)}
.hidden{display:none}
header{background:var(--p);color:#fff;padding:16px;text-align:center}
.container{padding:20px;max-width:1100px;margin:auto}
.card{background:#fff;padding:20px;border-radius:14px;margin-bottom:15px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
input,select,textarea,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:1px solid #ccc}
textarea{min-height:70px}
button{background:var(--p);color:#fff;border:none;font-weight:bold;cursor:pointer}
button.danger{background:var(--d)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
small{color:#666}
hr{border:none;border-top:1px solid #eee;margin:15px 0}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="container">
    <div class="card">
      <h2 align="center">LOGIN EMR</h2>
      <input id="username" placeholder="Username">
      <input id="pin" type="password" placeholder="PIN">
      <button onclick="login()">MASUK</button>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage" class="hidden">
<header>
<b>Sistem Informasi EMR</b><br>
Klinik dr. H. DUDI RUHENDERA
</header>

<div class="container">

<div class="card">
Login: <b id="userName"></b><br>
<small>Role: <b id="userRole"></b></small>
</div>

<div id="menu" class="grid"></div>

<!-- PENDAFTARAN & ANAMNESA -->
<div id="pendaftaranAnamnesaPage" class="card hidden">
<h3>Pendaftaran & Anamnesa Pasien</h3>

<h4>ðŸ§¾ Data Pasien</h4>
<input id="nama" placeholder="Nama Pasien">
<input id="nik" placeholder="NIK">
<input id="tgl" type="date">
<select id="jk">
<option value="">Jenis Kelamin</option>
<option>Laki-laki</option>
<option>Perempuan</option>
</select>
<textarea id="alamat" placeholder="Alamat"></textarea>
<input id="hp" placeholder="No HP">

<hr>

<h4>ðŸ©º Anamnesa Perawat</h4>
<small>No RM otomatis setelah simpan</small><br>
<b id="rmInfo"></b>

<textarea id="keluhan" placeholder="Keluhan Utama"></textarea>
<input id="td" placeholder="Tekanan Darah (mmHg)">
<input id="nadi" placeholder="Nadi (/menit)">
<input id="suhu" placeholder="Suhu (Â°C)">
<input id="rr" placeholder="RR (/menit)">
<textarea id="catatan" placeholder="Catatan Perawat"></textarea>

<button onclick="simpanPendaftaranAnamnesa()">
SIMPAN PASIEN & ANAMNESA
</button>
</div>

<div class="card">
<button class="danger" onclick="logout()">LOGOUT</button>
</div>

</div>
</div>

<script>
/* USER */
const USERS={
  "H.dudi_ruhendra":{pin:"Qwerty1234",role:"Dokter (Admin)"},
  "Username1":{pin:"User1",role:"Pendaftaran & Anamnesa"},
  "User2":{pin:"Username2",role:"Obat & Pembayaran"}
};

/* FIREBASE */
firebase.initializeApp({
  databaseURL:"https://develop-program-erm-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db=firebase.database();

/* LOGIN */
function login(){
  if(USERS[username.value] && USERS[username.value].pin===pin.value){
    localStorage.setItem("emr_user",username.value);
    showDashboard();
  } else alert("Username / PIN salah");
}

/* DASHBOARD */
function showDashboard(){
  const u=localStorage.getItem("emr_user");
  loginPage.classList.add("hidden");
  dashboardPage.classList.remove("hidden");
  userName.innerText=u;
  userRole.innerText=USERS[u].role;

  let m="";
  if(USERS[u].role.includes("Pendaftaran")){
    m+=`<div class="card" onclick="openPendaftaranAnamnesa()">Pendaftaran & Anamnesa</div>`;
  }
  menu.innerHTML=m;
}

/* PENDAFTARAN + ANAMNESA */
let currentRM="";

function openPendaftaranAnamnesa(){
  hideAll();
  pendaftaranAnamnesaPage.classList.remove("hidden");
}

function simpanPendaftaranAnamnesa(){
  if(!nama.value){ alert("Nama pasien wajib diisi"); return; }

  currentRM="RM"+Date.now();

  db.ref("pasien/"+currentRM).set({
    nama:nama.value,
    nik:nik.value,
    tgl:tgl.value,
    jk:jk.value,
    alamat:alamat.value,
    hp:hp.value,
    created:new Date().toISOString()
  });

  db.ref("anamnesa/"+currentRM+"/"+new Date().toISOString()).set({
    keluhan:keluhan.value,
    td:td.value,
    nadi:nadi.value,
    suhu:suhu.value,
    rr:rr.value,
    catatan:catatan.value,
    petugas:localStorage.getItem("emr_user")
  });

  rmInfo.innerHTML="<br><b>No RM: "+currentRM+"</b>";
  alert("Pendaftaran & Anamnesa berhasil disimpan");
}

/* UTIL */
function hideAll(){
  pendaftaranAnamnesaPage.classList.add("hidden");
}
function logout(){
  localStorage.clear();
  location.reload();
}
if(localStorage.getItem("emr_user")) showDashboard();
</script>

</body>
</html>
