<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>EMR Klinik ‚Äì Perawat Panel (FINAL v1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body{margin:0;font-family:Arial;background:#f5f7fa}
    header{background:#2e7d32;color:#fff;padding:12px 16px}
    .container{display:flex}
    aside{width:230px;background:#1b5e20;color:#fff;min-height:100vh}
    aside a{display:block;color:#fff;text-decoration:none;padding:12px}
    aside a:hover{background:#2e7d32}
    main{flex:1;padding:16px}
    .card{background:#fff;padding:12px;border-radius:6px;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
    h3{margin:6px 0 10px}
    h4{margin:10px 0 6px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #ddd;padding:6px;font-size:13px}
    th{background:#eee}
    input,select,button,textarea{padding:6px;margin:3px;font-size:13px}
    .hidden{display:none}
    .row{display:flex;flex-wrap:wrap;gap:8px}
    .col{flex:1;min-width:200px}
    ul{padding-left:18px}
    .badge{display:inline-block;padding:2px 6px;border-radius:4px;background:#eee;font-size:12px}
    .danger{background:#ffebee;color:#c62828}
    .ok{background:#e8f5e9;color:#2e7d32}
  </style>
</head>
<body>

<header>
  <b>EMR KLINIK ‚Äî PERAWAT PANEL (FINAL v1)</b>
  <span style="float:right">
    <button onclick="logout()">Logout</button>
  </span>
</header>

<div class="container">
  <aside>
    <a onclick="show('dashboard')">üè† Dashboard</a>
    <a onclick="show('antrian')">üü¢ Antrian</a>
    <a onclick="show('triase')">üöë Triase & Skrining</a>
    <a onclick="show('vital')">üíì Vital Sign</a>
    <a onclick="show('tindakan')">üíâ Tindakan Keperawatan</a>
    <a onclick="show('catatan')">üìù Catatan Keperawatan</a>
  </aside>

  <main>
    <!-- DASHBOARD -->
    <div id="dashboard" class="card">
      <h3>Dashboard</h3>
      <div class="row">
        <div class="col">Antrian Aktif: <b id="jAntrian">0</b></div>
        <div class="col">Pasien Hari Ini: <b id="jPasien">0</b></div>
        <div class="col">Tindakan Hari Ini: <b id="jTindakan">0</b></div>
      </div>
    </div>

    <!-- ANTRIAN -->
    <div id="antrian" class="card hidden">
      <h3>Antrian</h3>
      <table>
        <thead><tr><th>No</th><th>Nama</th><th>Poli</th><th>Aksi</th></tr></thead>
        <tbody id="listAntrian"></tbody>
      </table>
    </div>

    <!-- TRIASE -->
    <div id="triase" class="card hidden">
      <h3>Triase & Skrining</h3>
      <div class="row">
        <div class="col">
          <input id="tNamaPasien" placeholder="Nama Pasien">
          <select id="tKategori">
            <option value="">Kategori Triase</option>
            <option value="Merah">Merah</option>
            <option value="Kuning">Kuning</option>
            <option value="Hijau">Hijau</option>
          </select>
          <textarea id="tKeluhan" placeholder="Keluhan Utama"></textarea>
          <button onclick="simpanTriase()">Simpan Triase</button>
        </div>
        <div class="col">
          <h4>Hasil Terakhir</h4>
          <ul id="listTriase"></ul>
        </div>
      </div>
    </div>

    <!-- VITAL SIGN -->
    <div id="vital" class="card hidden">
      <h3>Vital Sign</h3>
      <input id="vNamaPasien" placeholder="Nama Pasien">
      <div class="row">
        <div class="col"><input id="vTD" placeholder="TD (mmHg)"></div>
        <div class="col"><input id="vNadi" placeholder="Nadi (x/menit)"></div>
        <div class="col"><input id="vRR" placeholder="RR (x/menit)"></div>
        <div class="col"><input id="vSuhu" placeholder="Suhu (¬∞C)"></div>
        <div class="col"><input id="vSpO2" placeholder="SpO2 (%)"></div>
      </div>
      <button onclick="simpanVital()">Simpan Vital</button>
      <table>
        <thead><tr><th>Waktu</th><th>Pasien</th><th>TD</th><th>Nadi</th><th>RR</th><th>Suhu</th><th>SpO2</th></tr></thead>
        <tbody id="listVital"></tbody>
      </table>
    </div>

    <!-- TINDAKAN -->
    <div id="tindakan" class="card hidden">
      <h3>Tindakan Keperawatan</h3>
      <input id="kNamaPasien" placeholder="Nama Pasien">
      <select id="kJenis">
        <option value="">Pilih Tindakan</option>
        <option value="Injeksi">Injeksi</option>
        <option value="Infus">Infus</option>
        <option value="Nebulizer">Nebulizer</option>
        <option value="Perawatan Luka">Perawatan Luka</option>
        <option value="Monitoring">Monitoring</option>
      </select>
      <textarea id="kCatatan" placeholder="Catatan Tindakan"></textarea>
      <button onclick="simpanTindakan()">Simpan Tindakan</button>
      <ul id="listTindakan"></ul>
    </div>

    <!-- CATATAN -->
    <div id="catatan" class="card hidden">
      <h3>Catatan Keperawatan</h3>
      <input id="cNamaPasien" placeholder="Nama Pasien">
      <textarea id="cIsi" placeholder="Catatan..."></textarea>
      <button onclick="simpanCatatan()">Simpan Catatan</button>
      <ul id="listCatatan"></ul>
    </div>
  </main>
</div>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "ISI_API_KEY",
  authDomain: "ISI_AUTH_DOMAIN",
  databaseURL: "ISI_DB_URL",
  projectId: "ISI_PROJECT_ID",
  storageBucket: "ISI_BUCKET",
  messagingSenderId: "ISI_SENDER_ID",
  appId: "ISI_APP_ID"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.database();

/* ================= AUTH GUARD (ROLE PERAWAT) ================= */
auth.onAuthStateChanged(user=>{
  if(!user){ location.href="index.html"; return; }
  db.ref("users/"+user.uid+"/role").once("value").then(s=>{
    if(s.val()!=="perawat"){
      alert("Akses khusus perawat");
      auth.signOut();
      location.href="index.html";
    }
  });
});

/* ================= NAV ================= */
function show(id){
  document.querySelectorAll("main .card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ================= DASHBOARD ================= */
function loadDashboard(){
  db.ref("antrian").on("value",s=> jAntrian.innerText=s.numChildren());
  db.ref("kunjungan").on("value",s=> jPasien.innerText=s.numChildren());
  db.ref("tindakan_keperawatan").on("value",s=> jTindakan.innerText=s.numChildren());
}
loadDashboard();

/* ================= ANTRIAN ================= */
db.ref("antrian").on("value",s=>{
  listAntrian.innerHTML="";
  s.forEach(c=>{
    const v=c.val();
    listAntrian.innerHTML+=`<tr>
      <td>${c.key}</td>
      <td>${v.nama||""}</td>
      <td>${v.poli||""}</td>
      <td><button onclick="panggil('${c.key}')">Panggil</button></td>
    </tr>`;
  });
});
function panggil(no){
  alert("Panggil antrian nomor "+no);
}

/* ================= TRIASE ================= */
function simpanTriase(){
  const nama=tNamaPasien.value, kat=tKategori.value, kel=tKeluhan.value;
  if(!nama||!kat) return alert("Lengkapi triase");
  const id=db.ref("triase").push().key;
  db.ref("triase/"+id).set({
    nama, kategori:kat, keluhan:kel,
    waktu:new Date().toLocaleString()
  });
  tNamaPasien.value=""; tKategori.value=""; tKeluhan.value="";
}
db.ref("triase").limitToLast(20).on("value",s=>{
  listTriase.innerHTML="";
  s.forEach(c=>{
    const v=c.val();
    const cls = v.kategori==="Merah" ? "danger" : "ok";
    listTriase.innerHTML+=`<li class="badge ${cls}">${v.waktu} ‚Äî ${v.nama} (${v.kategori})</li>`;
  });
});

/* ================= VITAL ================= */
function simpanVital(){
  const nama=vNamaPasien.value;
  if(!nama) return alert("Nama pasien kosong");
  const data={
    nama,
    td:vTD.value, nadi:vNadi.value, rr:vRR.value,
    suhu:vSuhu.value, spo2:vSpO2.value,
    waktu:new Date().toLocaleString()
  };
  const id=db.ref("vital").push().key;
  db.ref("vital/"+id).set(data);
  vNamaPasien.value=vTD.value=vNadi.value=vRR.value=vSuhu.value=vSpO2.value="";
}
db.ref("vital").limitToLast(30).on("value",s=>{
  listVital.innerHTML="";
  s.forEach(c=>{
    const v=c.val();
    listVital.innerHTML+=`<tr>
      <td>${v.waktu}</td><td>${v.nama}</td>
      <td>${v.td}</td><td>${v.nadi}</td><td>${v.rr}</td>
      <td>${v.suhu}</td><td>${v.spo2}</td>
    </tr>`;
  });
});

/* ================= TINDAKAN ================= */
function simpanTindakan(){
  const nama=kNamaPasien.value, jenis=kJenis.value, cat=kCatatan.value;
  if(!nama||!jenis) return alert("Lengkapi tindakan");
  const id=db.ref("tindakan_keperawatan").push().key;
  db.ref("tindakan_keperawatan/"+id).set({
    nama, jenis, catatan:cat, waktu:new Date().toLocaleString()
  });
  kNamaPasien.value=""; kJenis.value=""; kCatatan.value="";
}
db.ref("tindakan_keperawatan").limitToLast(20).on("value",s=>{
  listTindakan.innerHTML="";
  s.forEach(c=>{
    const v=c.val();
    listTindakan.innerHTML+=`<li>${v.waktu} ‚Äî ${v.nama}: ${v.jenis}</li>`;
  });
});

/* ================= CATATAN ================= */
function simpanCatatan(){
  const nama=cNamaPasien.value, isi=cIsi.value;
  if(!nama||!isi) return alert("Lengkapi catatan");
  const id=db.ref("catatan_keperawatan").push().key;
  db.ref("catatan_keperawatan/"+id).set({
    nama, isi, waktu:new Date().toLocaleString()
  });
  cNamaPasien.value=""; cIsi.value="";
}
db.ref("catatan_keperawatan").limitToLast(20).on("value",s=>{
  listCatatan.innerHTML="";
  s.forEach(c=>{
    const v=c.val();
    listCatatan.innerHTML+=`<li>${v.waktu} ‚Äî ${v.nama}: ${v.isi}</li>`;
  });
});

/* ================= UTIL ================= */
function logout(){
  auth.signOut();
  location.href="index.html";
}
</script>

</body>
</html>
